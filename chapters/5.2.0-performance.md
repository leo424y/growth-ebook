網站效能
---

網站效能直接影響到了網站的響應時間、吞吐量等等，也是運維、開發一系列技術的體現。

###網站效能監測

網站效能監測

> 網站可用性是網站效能監測的重要指標之一，表示在一段時間內，網站處於“正常狀態”的機率。

 - DNS 解析
 - 記憶體、硬碟等等
 - 網頁開啟速度

####應用效能指數

> Apdex 聯盟，一個由眾多網路分析技術公司和測量工業組成的聯盟組織，它們聯合起來開發了“應用效能指數”即“Apdex”(Application Performance Index)，用一句話來概括，Apdex 是使用者對應用效能滿意度的量化值。它提供了一個統一的測量和報告使用者體驗的方法，第一次把終端使用者的體驗和應用效能聯絡在了一起。

任務響應時間定義為：當使用者操作（滑鼠點選、輸入、回車）開始到系統（客戶機、網路、伺服器）響應從而使用者能繼續這個過程所經過的時間。這些等待時間定義了應用程式的“響應度”。該指數是基於應用程式響應度的三個方面：

 - 滿意:使用者充分工作。這就是目標時間（T秒），即在此時間裡使用者的工作沒有因應用程式的響應時間而受阻，如3秒。
 - 容忍:使用者感覺到響應滯後，響應時間大於 T，但能繼續這個過程，如3～12秒。
 - 挫折:響應時間大於 F 秒的效能是不能接受的，使用者可能放棄這個過程。F 等於 T×4，在本例子中為12秒。


###網站效能

針對網站效能優化領域，網上已經有相當多的總結，這裡只羅列一些常見（我用過）的策略。

#####減少 HTTP 請求

從網上查詢的情況分類來看，有下面的一些情況：

 - 合併 JavaScript 和 CSS。只是這種方式需要好好評估，因為合併過多的 JavaScript，可能會導致 JavaScript 檔案過大。一個大的檔案將增加 Load時間，導致不好的使用者體驗。
 - CSS Sprites。即將一個頁面涉及到的所有零星圖片都包含到一張大圖中去。值得注意的是，像 Logo 這一類檔案將不要加到裡面去了。
 - 拆分初始化負載。將頁面載入時需要的一堆 JavaScript 檔案，分成兩部分：渲染頁面所必需的和其他的。頁面初始化時，只載入必須的，其餘的等會載入。
 - 劃分主域。將資源劃分的請求劃分到幾個不同的域上，來加速資源請求。

對於我這樣的懶人來說，我使用 Google 出品的 [PageSpeed](https://developers.google.com/speed/pagespeed/?hl=zh-CN)。它主要的功能是針對前端頁面而進行伺服器端的優化，對前端設計人員來說，可以省去優化 css、js 以及圖片的過程。它可以對 CSS 和 JavaScript 壓縮、合併、級聯、內聯，生成一個新的 Script 和 CSS 檔案 。還有影象優化：剝離後設資料、動態調整，重新壓縮，如針對 Chrome 瀏覽器生成 WebP 檔案。還可以推遲影象和 JavaScript 載入。

####頁面內部優化

HTML 頁面內的優化的目的便是：**儘快渲染出頁面**。常見的優化策略便是：

 - 將 CSS 放在頂部，即早點渲染出頁面及其樣式。
 - 將 JavaScript 放在底部。如果有後臺渲染機制，那麼就應該將 JS 放到頁面底部來加速頁面載入。如果是單頁面應用，那麼這個 JS 就應該在頁面頂部。
 - 壓縮 HTML。在我們寫模板的過程中，一些判斷可能會導致頁面有過多的空格。壓縮這些 HTML，可以稍微提高一下頁面速度。

這裡的大部分內容都應該通過修改程式碼來完成。

####啟用快取

前面的快取一節裡，我們說過了一些快取的策略，我們再稍微提一下。

 - 後臺優化，如資料庫端快取
 - 啟用頁面快取，即應用層快取

####減少下載量

簡單地來說，就是減少對伺服器的請求：

 - 使用 CDN
 - 使用外部 JavaScript 和 CSS
 - 快取：使用 gzip 壓縮、新增 Expires 頭、配置 ETag、使 AjaX 可快取

####網路連線上的優化

主要就是對域名到伺服器進行優化，因此從方法上有：

 - DNS 域名解析加速
 - 減少 DNS 查詢
