測試替身
---

測試替身（Test Double）是一個非常有意思的概念。

> 有時候對被測系統(SUT)進行測試是很困難的，因為它依賴於其他無法在測試環境中使用的元件。這有可能是因為這些元件不可用，它們不會返回測試所需要的結果，或者執行它們會有不良副作用。在其他情況下，我們的測試策略要求對被測系統的內部行為有更多控制或更多可見性。
> 如果在編寫測試時無法使用（或選擇不使用）實際的依賴元件(DOC)，可以用測試替身來代替。測試替身不需要和真正的依賴元件有完全一樣的的行為方式；他只需要提供和真正的元件同樣的 API 即可，這樣被測系統就會以為它是真正的元件！ ——Gerard Meszaros

當我們遇到一些難以測試的方法、行為的時候，我們就一些特別的方式來幫助我們測試。Mock 和 Stub 就是常見的兩種方式：

1. Stub 是一種狀態確認，它用簡單的行為來替換複雜的行為
2. Mock 是一種行為確認，它用於模擬其行為

通俗地來說：Stub 從某種程度上來說，會返回我們一個特定的結果，用程式碼替換來方法；而 Mock 只是確保這個方法被呼叫。

###Stub

Stub 從字面意義上來說是存根，存根可以理解為我們保留了一些預留的結果。這個時候我們相當於構建了這樣一個特殊的測試場景，用於替換諸如網路或者 IO 排程等高度不可預期的測試。如當我們需要去驗證某個 API 被呼叫並返回了一個結果，舉例在最小物聯網系統設計中返回的 json，我們可以在本地構建一個

```javascript
[{"id":1,"temperature":14,"sensors1":15,"sensors2":12,"led1":1}]
```

的結果來當我們預期的資料，也就是所謂的存根。那麼我們所要做的也就是解析 json，並返回預期的結果。當我們依賴於網路時，此時測試容易出現問題。

###Mock

Mock 從字面意義上來說是模仿，也就是說我們要在本地構造一個模仿的環境，而我們只需要驗證我們的方法被呼叫了。

```javascript
var Foo = function(){};
Foo.prototype.callMe = function() {};
var foo = mock( Foo );

foo.callMe();

expect( foo.callMe ).toHaveBeenCalled();
```
