浮現式設計
---

設計模式不是一開始就有的，好的軟體也不是一開始就設計成現在這樣的，好的設計亦是如此。

導致我們重構現有系統的原因有很多，但是多數是因為原來的程式碼變得越來越不可讀，並且重構的風險太大了。在實現業務邏輯的時候，我們快速地用程式碼實現，沒有測試，沒有好的設計。

而下圖算是最近兩年來想要的一個答案：

![浮現式設計](assets/article/chapter8/emergent-design.jpg)

浮現式設計是一種敏捷技術，強調在開發過程中不斷演進。軟體本身就不應該是一開始就設計好的，它需要經歷一個演化的過程。

###意圖導向

和 Growth 一樣，在最開始的時候，我不知道我想要的是怎樣的——我只有一個想法以及一些相對應的實踐。接著我便動手開始做了，這是我的風格。不得不說這是結果導向程式設計，也是大部分軟體開發採用的方法。

所以在一開始的時候，我們就有了下面的程式碼：

```javascript
if (rating) {
    $scope.showSkillMap = true;
    skillFlareChild[skill.text] = [rating];

    $scope.ratings = $scope.ratings + rating;
    if (rating >= 0) {
      $scope.learnedSkills.push({
        skill: skill.text,
        rating: rating
      });
    }

    if ($scope.ratings > 250) {
      $scope.isInfinite = true;
    }
  }
```

程式碼在不經意間充斥著各種 Code Smell:

1. Magic Number
2. 超長的類
3. 等等

###重構

還好我們在一開始的時候寫了一些測試，這讓我們可以有足夠的可能性來重構程式碼，而使其不至於變成遺留程式碼。這也是我們推崇的一些基本實踐：

> 紅 -> 綠 -> 重構

測試是系統不至於腐爛的一個後勤保障，除此我們還需要保持對於 Code Smell 的嗅覺。如上程式碼：

```javascript
if ($scope.ratings > 250) {
  $scope.isInfinite = true;
}
```

上面程式碼中的“250”指的到底是？這樣的數字怎麼能保證別人一看程式碼就知道250到底是什麼？

如下的程式碼就好一些：

```javascript
var MAX_SKILL_POINTS = 250;
if ($scope.ratings > MAX_SKILL_POINTS) {
  $scope.isInfinite = true;
}
```

而在最開始的時候我們想不到這樣的結果。最初我們的第一直覺都是一樣的，然而只要我們保持著對 Code Smell 的警惕，情況就會發生更多的變化。

重構是區分普通程式設計師和專業程式設計師的一個門檻，也是練習得來的一個結果。

###模式與演進

如果你還懂得一些設計模式，那麼想來，軟體開發這件事就變得非常簡單——我們只需要理解好需求即可。

從一開始就使用模式，要麼你是專家，要麼你是在自尋苦惱。模式更多的是一些實現的總結，對於多數的實現來說，它們有著諸多的相似之處，可以使用相同的模式。

而在需求變化的過程中，一個設計的模式本身也是在不斷的改變。如果我們還固執於原有的模式，那麼我們就會犯下一個又一個的錯誤。

在適當的時候改變原有的模式，進行一些演進變顯得更有意義一些。如果我們不能在適當的時候引進一些新的技術，那麼舊有的技術就會不斷累積。這些技術債就會不斷往下疊加，這個系統將會接近於崩塌。而我們在一開始所設定的一些業務邏輯，也會隨著系統而逝去，這個公司似乎也要到盡頭了。

而如果我們可以不斷地演進系統——抽象服務、拆分模組等等。業務就可以在技術不斷演進地過程中得以保留。
