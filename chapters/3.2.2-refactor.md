程式碼重構
---

> 重構，一言以蔽之，就是在不改變外部行為的前提下，有條不紊地改善程式碼。

程式碼重構（英語：Code refactoring）指對軟體程式碼做任何更動以增加可讀性或者簡化結構而不影響輸出結果。在經歷了一年多的工作之後，我平時的主要工作就是修 Bug。剛開始的時候覺得無聊，後來才發現修 Bug 需要更好的技術。有時候你可能要面對著一坨一坨的程式碼，有時候你可能要花幾天的時間去閱讀程式碼。而，你重寫那幾十行程式碼可能只會花上你不到一天的時間。但是如果你沒辦法理解當時為什麼這麼做，你的修改只會帶來更多的 Bug。修 Bug，更多的是維護程式碼。還是前人總結的那句話對:

> 寫程式碼容易，讀程式碼難。

假設我們寫這些程式碼只要半天，而別人讀起來要一天。為什麼不試著用一天的時間去寫這些程式碼，讓別人花半天或者更少的時間來理解。

###重新命名

在上一節中，我們提到了命名的重要性，這裡首先要說到的也就是重新命名~~~。再看看《編寫可讀程式碼的藝術》也提到了這幾點：

1. 選擇專業的詞。最好是可以和業務相關的，它應該極具表現力。
2. 避免像 tmp 和 retval 這樣泛泛的名字。不得不提到的一點是，tmp 實在是一個有夠爛的名字，將其變為 timeTemp 或者類似的會更直觀。它只應該是名字中的一部分。
3. 用具體的名字代替抽象的名字。
4. 為名字賦予更多的資訊。
5. 名字應該有多長。
6. 利用名字的格式來傳遞含義。

###提取變數

先讓我們來看看一個簡單的情況：

```javascript
if ($scope.goodSkills.indexOf('analytics') !== -1) {
  skills.analytics = 5;
}
```

在上面的程式碼裡比較難以看懂的就是數字5，這時候你會怎麼做？寫一行註釋？這裡的5就是一個 Magic Number。

而實際上，最簡單有效的辦法就是把5提取成一個變數：


```javascript
var LEVEL_FIVE = 5;
if ($scope.goodSkills.indexOf('analytics') !== -1) {
  skills.analytics = LEVEL_FIVE;
}
```

###提煉函數

這個簡單有效的方法就是為了對付之前太長的函數，抽取提煉函數出應該抽取出來的部分成為一個新的函數。引自《重構》一書的說法，短的精巧的函數有以下的特點：

1. 如果每個函數的粒度都很小，那麼函數被複用的機會就更大；
2. 是這會讓高層函數讀起來就像一系列註釋一樣，容易理解；
3. 是如果函數都是細粒度，那麼函數的複寫也會更加容易。

在提煉函數中我們所要做的就是——判斷出原有的函數的意圖，再依據我們的新意圖來命名新的函數。然後判斷依賴——變數值，處理這些變數。提取出函數，再對其測試。

這裡只簡單地對重構進行一些介紹，更多詳細資訊請參閱《重構：改善既有程式碼的設計》。
